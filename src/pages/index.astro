---
import Layout from '~/layouts/PageLayout.astro';
import Hero from '~/components/widgets/Hero.astro';
import Features from '~/components/widgets/Features.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import { getPermalink } from '~/utils/permalinks';

const metadata = {
  title: 'tattva-3d â€” 3d Prints on Demand',
  ignoreTitleTemplate: true,
};
---

<Layout metadata={metadata}>
  <!-- Hero Widget ******************* -->

  <Hero
    tagline="Welcome to tattva-3d"
    actions={[
      {
        variant: 'primary',
        text: 'View Gallery',
        href: getPermalink('/gallery'),
        icon: 'tabler:photo',
      },
      { text: 'Get Started', href: getPermalink('/contact') },
    ]}
  >
    <Fragment slot="title">
      3d Prints on Demand
    </Fragment>

    <Fragment slot="subtitle">
      <span class="hidden sm:inline">
        Transform your ideas into unique 3d printed gifts, branding materials, and creative keepsakes.
      </span>
    </Fragment>

    <!-- Video Background -->
    <Fragment slot="bg">
      <div class="absolute inset-0 overflow-hidden">
        <video
          autoplay
          muted
          loop
          playsinline
          class="hero-video"
          poster="/videos/timelapse-poster.jpg"
        >
          <source src="/videos/timelapse-hd.webm" type="video/webm">
          <source src="/videos/timelapse-hd.mp4" type="video/mp4">
          <!-- Fallback for mobile -->
          <source src="/videos/timelapse-mobile.mp4" type="video/mp4" media="(max-width: 768px)">
        </video>
        <!-- Dynamic overlay for better text readability in both modes -->
        <div class="absolute inset-0 hero-overlay-light dark:hero-overlay-dark"></div>
      </div>
    </Fragment>
  </Hero>

  <!-- Features Widget *************** -->

 <Features
  id="features"
  tagline="What we create"
  title="Unique 3d prints for every occasion"
  subtitle="From personalized presents to business promotional items."
  columns={2}
  classes={{
    container: 'py-16 bg-gray-50/50 dark:bg-slate-900/80',
    items: {
      container: 'justify-items-center',
      panel: 'flex flex-row items-center justify-center text-center max-w-xs',
      title: 'md:text-[1.3rem] ml-3',
      icon: 'text-white bg-primary rounded-full w-12 h-12 p-3 flex-shrink-0',
    }
  }}
    items={[
      {
        title: 'Custom Gifts',
        icon: 'tabler:gift',
      },
      {
        title: 'Business Branding',
        icon: 'tabler:building-store',
      },
      {
        title: 'Creative Art',
        icon: 'tabler:palette',
      },
      {
        title: 'Miniature Models',
        icon: 'tabler:building-monument',
      },
    ]}
  />

  <!-- Instagram Feed Section using SnapWidget -->
  <section class="py-16 bg-white/80 dark:bg-slate-800/90 backdrop-blur-sm">
    <div class="max-w-6xl mx-auto px-4 sm:px-6">
      <div class="text-center mb-8">
        <h2 class="text-3xl font-bold mb-4 text-gray-900 dark:text-gray-100">Follow Our Journey</h2>
        <p class="text-lg text-gray-600 dark:text-gray-300">
          See our latest 3D prints and behind-the-scenes content on Instagram
        </p>
      </div>

      <!-- SnapWidget Instagram Feed Container -->
      <div class="flex justify-center mb-8">
        <div id="snapwidget-container" class="w-full max-w-4xl">
          <!-- SnapWidget Instagram Feed -->
          <div class="rounded-lg overflow-hidden shadow-lg bg-white dark:bg-slate-800 border border-gray-100 dark:border-slate-700">
            <iframe src="https://snapwidget.com/embed/1108094" 
                    class="snapwidget-widget" 
                    allowtransparency="true" 
                    frameborder="0" 
                    scrolling="no" 
                    style="border:none; overflow:hidden; width:100%; height:750px;" 
                    title="Posts from Instagram"></iframe>
          </div>
        </div>
      </div>

      <!-- Call to Action -->
      <div class="text-center mt-8">
        <a 
          href="https://www.instagram.com/tattva_3d/" 
          target="_blank" 
          rel="noopener noreferrer"
          class="inline-flex items-center px-8 py-3 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-medium rounded-lg hover:from-purple-600 hover:to-pink-600 transition-all duration-200"
        >
          <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 24 24">
            <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.40z"/>
          </svg>
          Follow @tattva_3d
        </a>
      </div>
    </div>
  </section>

  <!-- CallToAction Widget *********** -->

  <CallToAction
    actions={[
      {
        variant: 'primary',
        text: 'Start Your Project',
        href: getPermalink('/contact'),
        icon: 'tabler:message-circle',
      },
    ]}
  >
    <Fragment slot="title">
      Ready to create something unique?
    </Fragment>

    <Fragment slot="subtitle">
      Share your idea and let's bring it to life with 3d printing.
    </Fragment>
  </CallToAction>
</Layout>

<!-- SnapWidget Script -->
<script src="https://snapwidget.com/js/snapwidget.js"></script>

<!-- Video Background Optimization -->
<style>
  /* Ensure video covers the full hero area */
  .hero-video {
    width: 100vw;
    height: 100vh;
    object-fit: cover;
    position: absolute;
    top: 0;
    left: 0;
    z-index: -1;
    transition: opacity 0.3s ease;
  }

  /* Different opacity for light and dark modes */
  :root .hero-video {
    opacity: 0.25; /* Light mode - more visible */
  }

  :root.dark .hero-video {
    opacity: 0.4; /* Dark mode - more visible to show through dark background */
  }

  /* Optimize video loading on mobile */
  @media (max-width: 768px) {
    .hero-video {
      opacity: 0.2 !important; /* Consistent mobile opacity */
    }
  }

  /* Enhanced gradient overlays for better text contrast */
  .hero-overlay-light {
    background: linear-gradient(135deg, rgba(255,255,255,0.1) 0%, rgba(0,0,0,0.3) 100%);
  }

  .hero-overlay-dark {
    background: linear-gradient(135deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.6) 100%);
  }
</style>

<!-- Auto-resize SnapWidget iframe -->
<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Give SnapWidget time to load, then adjust height
    setTimeout(function() {
      const iframe = document.querySelector('.snapwidget-widget');
      if (iframe) {
        // Set to 750px to show complete 2 rows (3x2 grid)
        iframe.style.height = '750px'; 
      }
    }, 2000);

    // Ensure video starts playing after load
    const heroVideo = document.querySelector('.hero-video');
    if (heroVideo) {
      heroVideo.play().catch(() => {
        // If autoplay is blocked, the video will still show the first frame
        console.log('Video autoplay was prevented, showing poster/first frame');
      });
    }
  });
</script>
